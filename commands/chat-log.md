# 会話ログ保存（月次管理）

## 概要

このチャットセッションでのユーザーとClaudeのやり取りを、`.claude/chat-log/` ディレクトリに保存する。
月を跨いで当月ディレクトリに前月以前のファイルが存在する場合は、`old/` に移動する。

## 機能

- セッション会話の完全な記録
- タイムスタンプ付きファイル名（`chat_yyyymmdd_HHmm.md`）
- セッションサマリーの自動生成
- 機密情報（APIキー、パスワード等）の自動マスキング
- 月次アーカイブ（過去月のログを `old/` フォルダに自動退避）

## 保存先

- **ベースディレクトリ**: `.claude/chat-log/`
- **チャットログ**: `.claude/chat-log/chat_yyyymmdd_HHmm.md`
- **過去月退避先**: `.claude/chat-log/old/`

## 月次アーカイブ機能について

コマンド実行時に、過去月のチャットログを自動的に `old/` フォルダに退避する。

### 動作

1. 当月（`yyyymm`）を算出
2. ベースディレクトリ内の `chat_*.md` ファイルを確認
3. ファイル名の日付部分（`chat_yyyymmdd_HHmm.md` の `yyyymm`）が当月でないファイルがある場合、`old/` フォルダに移動

これにより、ベースディレクトリには常に当月分のログのみが保持される。

## 実行手順

1. 本日の日付と現在時刻を取得（`yyyy-mm-dd_HHmm`）し、当月の `yyyymm`（例: `202602`）を算出
2. `.claude/chat-log/` ディレクトリを作成（存在しない場合）
3. 月跨ぎ/初回の判定とファイル整理
   - ベースディレクトリ内の `chat_*.md` ファイルを確認
   - ファイル名の日付部分（`chat_yyyymmdd_HHmm.md` の `yyyymm`）が当月でないファイルがある場合：
     - `old/` ディレクトリを作成（存在しない場合）
     - 該当ファイルを `old/` に移動（ファイル名は維持）
4. ファイル名を `chat_yyyymmdd_HHmm.md` として決定
5. このチャットセッションの会話内容を以下のフォーマットで記録

## 記載フォーマット

```text
# チャットログ

- 日時: yyyy-mm-dd HH:mm
- セッション概要: （会話の主題を1行で要約）

---

## 会話内容

### ユーザー
（ユーザーの発言）

### Claude
（Claudeの応答）

### ユーザー
（ユーザーの発言）

### Claude
（Claudeの応答）

...（以降繰り返し）

---

## セッションサマリー

### 主なトピック
- トピック1
- トピック2

### 実行されたアクション
- アクション1
- アクション2

### 未解決事項・次回への申し送り
- 事項1
- 事項2
```

## 注意事項

- 会話内容は省略せず、できるだけ忠実に記録する
- ただし、ツール実行の詳細出力（長いログなど）は要約してもよい
- 機密情報（APIキー、パスワード等）が含まれる場合は `[REDACTED]` に置換する
- コードブロックは適切にマークダウン記法で囲む
- ファイル名の重複を避けるため、時刻を含める
- チャットログは常にベースディレクトリに「当月分のみ」置き、過去月は `old/` に退避する

## セキュリティ

- 機密情報（APIキー、パスワード等）が含まれる場合は `[REDACTED]` に自動置換
- 保存されたログファイルに機密情報が含まれていないか、保存後に確認することを推奨
